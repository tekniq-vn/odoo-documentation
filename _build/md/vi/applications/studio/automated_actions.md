# Quy tắc tự động hoá

Automation rules are used to trigger automatic changes based on user actions (e.g., apply a
modification when a field is set to a specific value), email events, time conditions (e.g., archive
a record 7 days after its last update), or external events.

To create an automation rule with Studio, proceed as follows:

1. [Open Studio](../studio.md#studio-access) and click Automations, then New.
2. Select the [Kích hoạt](#studio-automated-actions-trigger) and, if necessary, fill in the fields that
   appear on the screen based on the chosen trigger.
3. Click Add an action, then select the Type of
   [action](#studio-automated-actions-action) and fill in the fields that appear on the screen
   based on your selected action.
4. Click Save & Close or Save & New.

<a id="studio-automated-actions-trigger"></a>

## Kích hoạt

The Trigger is used to define when the automation rule should be applied. The available
triggers depend on the [model](models_modules_apps.md). Five trigger categories are available
overall:

- [Giá trị đã được cập nhật](#studio-automated-actions-trigger-values-updated)
- [Sự kiện email](#studio-automated-actions-trigger-email-events)
- [Điều kiện thời gian](#studio-automated-actions-trigger-values-timing-conditions)
- [Tùy chỉnh](#studio-automated-actions-trigger-custom)
- [Bên ngoài](#studio-automated-actions-trigger-external)

<a id="studio-automated-actions-trigger-values-updated"></a>

### Giá trị đã được cập nhật

The triggers available in this category depend on the model and are based on common field changes,
such as adding a specific tag (e.g., to a task) or setting the User field. Select the
trigger, then select a value if required.

![Example of a Values Updated trigger](applications/studio/automated_actions/values-updated-trigger.png)

<a id="studio-automated-actions-trigger-email-events"></a>

### Sự kiện email

Trigger automated actions upon receiving or sending emails.

<a id="studio-automated-actions-trigger-values-timing-conditions"></a>

### Điều kiện thời gian

Trigger automated actions based on a date field. The following triggers are available:

- Based on date field: Select the field to be used next to the Delay field.
- After creation: The action is triggered when a record is created and saved.
- After last update: The action is triggered when an existing record is edited and
  saved.

You can then define:

- a Delay: Specify the number of minutes, hours, days, or months. To trigger the action
  before the trigger date, specify a negative number. If you selected the Based on date
  field trigger, you must also select the date field to be used to determine the delay.
- Extra Conditions: Click Add condition, then specify the conditions to be
  met to trigger the automation rule. Click New Rule to add another condition.

The action is triggered when the delay is reached and the conditions are met.

#### NOTE
By default, the scheduler checks for trigger dates every 4 hours, meaning lower granularity in
time-based automations may not always be honored.

<a id="studio-automated-actions-trigger-custom"></a>

### Tùy chỉnh

Trigger automated actions:

- On save: When the record is saved;
- On deletion: When a record is deleted;
- On UI change: When a field's value is changed on the [Form view](views.md#studio-views-general-form), even before saving the record.

For the On save and On UI change triggers, you **must** then select the
field(s) to be used to trigger the automation rule in the When updating field.

#### WARNING
If no field is selected in the When updating field, the automated action may be
executed multiple times per record.

Optionally, you can also define additional conditions to be met to trigger the automation rule in
the Apply on field.

#### NOTE
The On UI change trigger can only be used with the
[Thực thi mã](#studio-automated-actions-action-python-code) action and only works when a modification is
made manually. The action is not executed if the field is changed through another automation
rule.

<a id="studio-automated-actions-trigger-external"></a>

### Bên ngoài

Trigger automated actions based on an external event using a webhook. A webhook is a method of
communication between two systems where the source system sends an HTTP(S) request to a destination
system based on a specific event. It usually includes a data payload containing information about
the event that occurred.

To configure the On webhook trigger, copy the URL generated by Odoo into the
destination system (i.e., the system receiving the request). Then, in the Target Record
field, enter the code to run to define the record(s) to be updated using the automation rule.

#### WARNING
The URL must be treated as **confidential**; sharing it online or without caution could
potentially expose your system to malicious parties. Click the Rotate Secret button
to change the URL's secret if necessary.

#### NOTE
- The code defined by default in the Target Record field works for webhooks coming
  from another Odoo database. It is used to determine the record(s) to be updated using the
  information in the payload.
- If you wish to use the webhook's content for a purpose other than to find the record(s) (e.g.,
  *create* a record), your only option is to use an [Thực thi mã](#studio-automated-actions-action-python-code)
  action. In this case, the Target record field must contain any valid code, but its
  result doesn't have any effect on the automated action itself.
- The webhook content is available in the server action context as a `payload` variable (i.e., a
  dictionary that contains the GET parameters or POST JSON body of the incoming request).

You can also choose to Log Calls to record the payloads received, e.g., to make sure the
data sent by the source system matches the expected format and content. This also helps identify
and diagnose any issues that may arise. To access the logs, click the Logs smart
button at the top of the Automation rules form.

<a id="studio-automated-actions-action"></a>

## Tác vụ cần thực hiện

Once you have defined the automation rule's [trigger](#studio-automated-actions-trigger), click
Add an action to define the action to be executed.

<a id="studio-automated-actions-action-update-record"></a>

### Cập nhật tập dữ liệu

This action allows to update one of the record's (related) fields. Click the Update
field and, in the list that opens, select or search for the field to be updated; click the right
arrow next to the field name to access the list of related fields if needed.

If you selected a [many2many field](fields.md#studio-fields-relational-fields-many2many), choose whether
the field must be updated by Adding, Removing, or Setting it to
the selected value or by Clearing it.

### Tạo hoạt động

This action is used to schedule a new activity linked to the record. Select an Activity
Type, enter a Title and description, then specify when you want the activity to be
scheduled in the Due Date In field, and select a User type:

- To always assign the activity to the same user, select Specific User and add the user
  in the Responsible field;
- To target a user linked to the record dynamically, select Dynamic User (based on
  record) and change the User Field if necessary.

### Send Email and Send SMS

These actions are used to send an email or a text message to a contact linked to a specific record.
To do so, select or create an Email Template or an SMS Template, then, in
the Send Email As or Send SMS As field, choose how you want to send the
email or text message:

- Email: to send the message as an email to the recipients of the Email
  Template.
- Message: to post the message on the record and notify the record's followers.
- Note: to send the message as an internal note visible to internal users in the
  chatter.
- SMS (without note): to send the message as a text message to the recipients of the
  SMS template.
- SMS (with note): to send the message as a text message to the recipients of the
  SMS template and post it as an internal note in the chatter.
- Note only: to only post the message as an internal note in the chatter.

<a id="studio-automated-actions-action-add-followers"></a>

### Add Followers and Remove Followers

Use these actions to (un)subscribe existing contacts to/from the record.

### Tạo tập dữ liệu

This action is used to create a new record on any model.

Select the required model in the Record to Create field; it contains the current model
by default. Specify a Name for the record, and then, if you want to create the record on
another model, select a field in the Link Field field to link the record that
triggered the creation of the new record.

#### NOTE
The dropdown list related to the Link Field field only contains [one2many fields](fields.md#studio-fields-relational-fields-one2many) existing on the current model that are linked to a
[many2one field](fields.md#studio-fields-relational-fields-many2one) on the target model.

<a id="studio-automated-actions-action-python-code"></a>

### Thực thi mã

This action is used to execute Python code. You can write your code into the Code tab
using the following variables:

- `env`: environment on which the action is triggered
- `model`: model of the record on which the action is triggered; is a void recordset
- `record`: record on which the action is triggered; may be void
- `records`: recordset of all records on which the action is triggered in multi-mode; this may be
  left empty
- `time`, `datetime`, `dateutil`, `timezone`: useful Python libraries
- `float_compare`: utility function to compare floats based on specific precision
- `log(message, level='info')`: logging function to record debug information in ir.logging
  table
- `_logger.info(message)`: logger to emit messages in server logs
- `UserError`: exception class for raising user-facing warning messages
- `Command`: x2many commands namespace
- `action = {...}`: to return an action

### Gửi thông báo webhook

This action allows to send a POST request with the values of the Fields to the URL
specified in the URL field.

The Sample Payload provides a preview of the data included in the request using a random
record's data or dummy data if no record is available.

<a id="studio-automated-actions-action-several-actions"></a>

### Thực thi tác vụ hiện có

The action is used to trigger multiple actions (linked to the current model) at the same time. To do
so, click on Add a line, then, in the Add: Child Actions pop-up, select an
existing action or click New to create a new one.
